var ee=Object.defineProperty,te=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var I=(e,t,n)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x=(e,t)=>{for(var n in t||(t={}))re.call(t,n)&&I(e,n,t[n]);if(B)for(var n of B(t))se.call(t,n)&&I(e,n,t[n]);return e},M=(e,t)=>te(e,ne(t));const ie="https://beta.find.auslan.fyi/datasets/search-index",ae="https://beta.find.auslan.fyi/datasets/cc-en-300-8bit",oe="https://beta.find.auslan.fyi/datasets/update-log.cbor";var rt={searchIndex:ie,vectorIndex:ae,updateLog:oe};function _e(e,t){return Array.from(ce(e,t))}function*ce(e,t){if(e<1)return;let n=0;for(;n<e;)yield t(n,e),n+=1}function fe(e,t,n=1/0){return[...ue(e,t,n)]}function*ue(e,t,n=1/0){const r=e[Symbol.iterator]();for(;n>0;){const s=[];for(;s.length<t;){const i=r.next();if(i.done){s.length>0&&(yield s);return}else s.push(i.value)}yield s,n-=1}}function de(e,t){const n=e.toString(2);return"0".repeat(t-n.length)+n}function le(e){const t=e.slice(0,1),n=e.slice(1),r=parseInt(n,2);return t==="0"?+r:-r}function D(e){return Array.from(e,t=>de(t,8)).join("")}function st(e,t=0){return D([...e].slice(0,Math.ceil(t/8))).slice(0,t)}function he(e,t,n){const r=D(e);return _e(n,s=>le(r.slice(s*t,(s+1)*t))/(2**(t-1)-1))}function pe(...e){return e.reduce((t,n)=>t.map((r,s)=>r+n[s]))}function ye(e,t){return e.map(n=>n.map((r,s)=>r*t[s]))}function be(...e){return ye([pe(...e)],me(1/e.length,e[0].length))[0]}function me(e,t){return new Array(t).fill(e,0,t)}function we(e,t){let n=0;for(let r=0;r<e.length;r++){const s=e[r]-t[r];n+=s*s}return n}function ge(...e){if(e.length<=1)return[0];const t=be(...e);return e.map(n=>we(n,t))}const g=Symbol("CBOR-break"),w=Symbol("CBOR-done"),R=Symbol("CBOR-EOC");function b(e){return t=>({__proto__:e,res:e.init(t)})}const L={[Symbol.toStringTag]:"cbor_tag",from(e,t){return{__proto__:this,tag:e,body:t}},to_cbor_encode(e,t){e.tag_encode(t.tag,t.body)}},xe={[Symbol.toStringTag]:"cbor_nest",from(e){return{__proto__:this,body:e}},to_cbor_encode(e,t){let{body:n,u8:r}=t;e.nest(n,"body"in t?null:r)},with_ctx(e){let t={__proto__:this,decode_cbor(){return this.body=e.from_nested_u8(this.u8).decode_cbor()}};return n=>({__proto__:t,u8:n})}};Array(256);Array(256);function ve(e){return new TextDecoder("utf-8").decode(e)}function Ae(e){return new TextEncoder("utf-8").encode(e)}typeof crypto!="undefined"?crypto.getRandomValues.bind(crypto):import("node:crypto".trim()).then(e=>e.randomFillSync);function S(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer):e instanceof ArrayBuffer?new Uint8Array(e):Uint8Array.from(e)}function O(e){let t=0,n=0;for(const s of e){const i=s.byteLength;if(typeof i!="number")throw new Error("Invalid part byteLength");n+=i}const r=new Uint8Array(n);for(const s of e)r.set(s,t),t+=s.byteLength;return r}async function*Se(e){yield S(e)}const A=Function.call.bind(Object.prototype.toString);function Ue(e,t){let n=new WeakSet,r,s,i;return t.rebind=_,f=>{f.encode=a=>o(a,f),f.encode_object=a=>s(a,f)};function _(f=e.host){n=new WeakSet,Object.defineProperties(e,{host:{value:f}}),r=f._simple_map,i=new Map(Oe);for(const[a,y]of f._encoder_map.entries())typeof a=="string"&&typeof y=="function"&&i.set(a,y);return f.bind_encode_object?s=f.bind_encode_object(e,i):f.encode_object&&(s=f.encode_object),s?i.set(A({}),s):s=i.get(A({})),t}function o(f,a){let y=je.get(f);if(y!==void 0){a.add_w0(y);return}if(r!==void 0){let p=r.get(f);if(p!==void 0){a.simple(p);return}}if(f.to_cbor_encode!==void 0&&!n.has(f)){n.add(f);try{return f.to_cbor_encode(a,f)}finally{n.delete(f)}}let c=i.get(A(f));return c!==void 0?c(f,a):s(f,a)}}const je=new Map([[!1,244],[!0,245],[null,246],[void 0,247],...Array.from({length:24},(e,t)=>[t,t]),...Array.from({length:24},(e,t)=>[-t-1,32+t])]),N=new Uint8Array([250,127,192,0,0]),$=new Uint8Array([250,128,0,0,0]),Me=new Map([[-0,$],[NaN,N],[1/0,new Uint8Array([250,127,128,0,0])],[-1/0,new Uint8Array([250,255,128,0,0])]]);function k(e,t){if(Number.isSafeInteger(e))e>0?t.add_mask(0,e):e<0?t.add_mask(32,-1-e):Object.is(-0,e)?t.raw_frame($):t.add_w0(0);else{const n=Me.get(e);n===void 0?t.float64(e):t.raw_frame(n)}}function h(e,t,n){let r=A(t);return e.set(r,n),r}const Oe=Ee(new Map);function Ee(e){h(e,NaN,(t,n)=>{n.raw_frame(N)}),h(e,void 0,(t,n)=>{n.add_w0(247)}),h(e,null,(t,n)=>{n.add_w0(246)}),h(e,!0,(t,n)=>{n.add_w0(t?245:244)}),h(e,"utf8",(t,n)=>{n.add_utf8(t)}),h(e,42,k),h(e,42.1,k),h(e,[],(t,n)=>{n.array(t)}),h(e,{},(t,n)=>{n.object_pairs(t)}),h(e,parseInt,()=>{ctx.invalid("function")}),h(e,Symbol.iterator,()=>{ctx.invalid("symbol")});{let n=function(r,s){s.add_bytes(r)},t=new ArrayBuffer(0);h(e,t,n),h(e,new DataView(t),n),h(e,new Uint8Array(t),n)}return e}const Be=24,Ie=25,ke=26,Ce=27,Te={__proto__:null,invalid(){this.add_w0(247)},simple(e){if(e<24)this.add_w0(224|e);else if(e<=255)this.add_w1(248,e);else throw new Error(`Invalid simple value: ${e}`)},tag_encode(e,t){let n=this.tag(e);return this.encode(t),n()},tag_encode_object(e,t){let n=this.tag(e);return this.encode_object(t),n()},tag(e,t){return e===!0&&(e=55799),this.add_mask(192,e),t||this.host.with_tag(e)},shared_tag(e){let t=this._ref_wm;t===void 0&&((this._ref_wm=t=new WeakMap).n=0);let n=t.get(e);if(n===void 0)return n=t.n++,t.set(e,n),this.tag(28);this.add_mask(192,29),this.add_int(n)},shared(e,t=e){let n=this.shared_tag(e);if(n!==void 0)return this.encode(t),n()},shared_object(e,t=e){let n=this.shared_tag(e);if(n!==void 0)return this.encode_object(t),n()},add_int(e){if(!Number.isSafeInteger(e))throw new TypeError;e>0?this.add_mask(0,e):e<0?this.add_mask(32,-1-e):this.add_w0(0)},sub_encode(e,t){return(this.sub_encode=F().rebind(this.host))(e,t)},nest(e,t){let n=this.tag(24);return this.add_buffer(64,t||this.sub_encode(e)),n()},bytes_stream(e){let{add_w0:t,add_bytes:n}=this;t(95);for(let r of e)n(r);t(255)},utf8_stream(e){let{add_w0:t,add_utf8:n}=this;t(127);for(let r of e)n(r);t(255)},array(e){let{add_mask:t,encode:n}=this,r=e.length;t(128,r);for(let s=0;s<r;s++)n(e[s])},list(e,t){let{add_mask:n,encode:r}=this;n(128,t);for(let s of e)if(r(s),0>=t--)return},list_stream(e){let{add_w0:t,encode:n}=this;t(159);for(let r of e)n(r);t(255)},_object_filter(e){let t=typeof e[1];return t!=="function"&&t!=="symbol"},object_pairs(e){let{add_mask:t,encode:n}=this,r=Object.entries(e).filter(this._object_filter),s=r.length;t(160,s);for(let i=0;i<s;i++){let _=r[i];n(_[0]),n(_[1])}},pairs(e,t){let{add_mask:n,encode:r}=this;n(160,t);for(let s of e)if(r(s[0]),r(s[1]),0>=t--)return},pair_stream(e){let{add_w0:t,encode:n}=this;t(191);for(let r of e)n(r[0]),n(r[1]);t(255)}};function F(e){let t=0,n=0;e==null?e=De():!e.flush&&e[Symbol.asyncIterator]&&(e=Re(e));const r=e.block_size||65536,s=new Uint8Array(r),i=new DataView(s.buffer),_={__proto__:Te,raw_frame:E,add_w0(u){l(u,1)},add_w1(u,d){s[l(u,2)]=d},add_mask:a,add_bytes:y,add_utf8:c,add_buffer:p,float16_short(u){i.setUint16(l(249,3),v)},float32(u){i.setFloat32(l(250,5),u)},float64(u){i.setFloat64(l(251,9),u)}};let o=Ue(_,f);return f;function f(u,d){let m={__proto__:_};if(o(m),d==null?m.encode(u):d===!0||typeof d=="number"?m.tag_encode(d,u):d.tag&&m.tag_encode(d.tag,u),n===0)return e.flush(null);let j=s.slice(0,n);return t=n=0,e.flush(j)}function a(u,d){if(d<=65535)d<24?l(u|d,1):d<=255?s[l(u|Be,2)]=d:i.setUint16(l(u|Ie,3),d);else if(d<=4294967295)i.setUint32(l(u|ke,5),d);else{let m=l(u|Ce,9),j=d/4294967296|0;i.setUint32(m,j);let Z=d&4294967295;i.setUint32(4+m,Z);return}}function y(u){p(64,S(u))}function c(u){p(96,Ae(u))}function p(u,d){a(u,d.byteLength),E(d)}function l(u,d){return t=n,n+=d,n>r&&(e.write(s.slice(0,t)),t=0,n=d),s[t]=u,1+t}function E(u){let d=u.byteLength;if(t=n,n+=d,n<=r){s.set(u,t);return}t!==0&&e.write(s.slice(0,t)),t=n=0,e.write(u)}}function De(){let e=[];return{write(t){e.push(t)},flush(t){if(e.length===0)return t;t!==null&&e.push(t);let n=O(e);return e=[],n}}}function Re(e){let t;return{write(n){t=e.next(n)},async flush(n){let r=n!==null?e.next(n):t;return t=null,await r}}}class P{static get create(){return t=>new this(t)}static get encode(){return new this().encode}static get encode_stream(){return t=>new this(t).encode}constructor(t){this.encode=F(t),this.rebind()}rebind(){return this.encode.rebind(this),this}with_tag(t){return Le}encoder_map(){return Object.hasOwnProperty(this,"_encoder_map")||(this._encoder_map=new Map(this._encoder_map),this.rebind()),this._encoder_map}simple_map(){return Object.hasOwnProperty(this,"_simple_map")||(this._simple_map=new Map(this._simple_map),this.rebind()),this._simple_map}with_encoders(t,n){let r=this._encoder_map=new Map(this._encoder_map),s=h.bind(null,r);return t(s,this),n?this:this.rebind()}}P.prototype._encoder_map=new Map;function Le(){}const V=new Uint8Array(Uint16Array.of(1).buffer)[0]===0,W=[[Uint8Array,64,64],[Uint16Array,65,69],[Uint32Array,66,70],[Uint8ClampedArray,68,68],[Int8Array,72,72],[Int16Array,73,77],[Int32Array,74,78],[Float32Array,81,85],[Float64Array,82,86]];function z(e){let t=e.byteLength,n=e.BYTES_PER_ELEMENT,r=new Uint8Array(e.buffer,e.byteOffset,t),s,i=0,_,o;for(;i<t;)for(_=i,o=i+n,i=o;_<o;)s=r[_],r[_++]=r[--o],r[o]=s;return e}function Ne(e,t){$e(e),Fe(e)}function $e(e,t){e(Promise.resolve(),()=>{throw new Error("Promises not supported for CBOR encoding")}),e(new Date,(n,r)=>{let s=r.tag(1);r.float64(n/1e3),s()}),e(new URL("ws://h"),(n,r)=>{let s=r.tag(32);r.add_utf8(n.toString()),s()}),e(new Set,(n,r)=>{let s=r.tag(258);r.list(n,n.size),s()}),e(new Map,(n,r)=>{let s=r.tag(259);r.pairs(n.entries(),n.size),s()})}function Fe(e){let t=new ArrayBuffer(0);for(let[n,r,s]of W)r!==64&&e(new n(t),(i,_)=>{V&&(i=z(i.slice()));let o=_.tag(s);_.add_bytes(i),o()})}class Pe extends P{}Pe.prototype.with_encoders(Ne,!0);class q{static options(t){return class extends this{}.compile(t)}static compile(t){return this.prototype.compile(t),this}constructor(t){t!=null&&this.compile(t),this._U8Ctx_.bind_decode_api(this)}compile(t){return this.jmp=this._bind_cbor_jmp(t,this.jmp),t.types&&(this.types=Object.assign(Object.create(this.types||null),t.types)),this._U8Ctx_=this._bind_u8ctx(this.types,this.jmp,t.unknown),this}}const U={__proto__:null,u32(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},u64(e,t){const n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return((e[t+4]<<24|e[t+5]<<16|e[t+6]<<8|e[t+7])>>>0)+4294967296*(n>>>0)},float16(e){return{"@f2":e}},float32(e,t=e.byteOffset){return new DataView(e.buffer,t,4).getFloat32(0)},float64(e,t=e.byteOffset){return new DataView(e.buffer,t,8).getFloat64(0)},bytes(e){return e},bytes_stream:b({init:()=>[],accum:C,done:e=>O(e)}),utf8(e){return ve(e)},utf8_stream:b({init:()=>[],accum:C,done:e=>e.join("")}),list:b({init:()=>[],accum:T}),list_stream(){return this.list()},map:b({init:()=>({}),accum:T}),map_stream(){return this.map()}};function C(e,t,n){e.push(n)}function T(e,t,n){e[t]=n}const Ve={map:b({init:()=>new Map,accum:(e,t,n)=>e.set(t,n)})},We={list:b({init:()=>new Set,accum:(e,t,n)=>e.add(n)})};function ze(e){qe(e),Ye(e),Ke(e),Ge(e)}function qe(e){e.set(0,()=>t=>new Date(t)),e.set(1,()=>t=>new Date(t*1e3)),e.set(24,t=>xe.with_ctx(t)),e.set(32,()=>t=>new URL(t)),e.set(55799,()=>{})}function Ke(e){let[t,n]=V?[1,2]:[2,1];for(let r of W){let s=r[0],i=s.BYTES_PER_ELEMENT,_=o=>o.byteOffset%i===0?new s(o.buffer,o.byteOffset,o.byteLength/i):new s(o.slice().buffer);e.set(r[t],o=>_),e.set(r[n],o=>f=>z(_(f)))}}function Ye(e){e.set(258,t=>{t.use_overlay(We)}),e.set(259,t=>{t.use_overlay(Ve)})}function Ge(e){let t=Symbol("cbor-shared");e.set(28,r=>{let s=n(r),i=s.n++,_;return s.set(i,new Promise(o=>_=o)),o=>(s.set(i,o),_(o),o)}),e.set(29,r=>s=>n(r).get(s));function n(r){let s=r[t];return s===void 0&&(s=new Map,s.n=0,r[t]=s),s}}class K{static subclass(t,n,r){class s extends this{}let{prototype:i}=s;return i.next_value=s.bind_next_value(n,r),i.types=t,s}from_nested_u8(t){return this.constructor.from_u8(t,this.types)}use_overlay(t){let{types:n,_apply_overlay:r,_overlay_noop:s}=this;return s===r&&(r=()=>{this.types=n}),this._apply_overlay=()=>{this._apply_overlay=r,this.types=t},n}_error_unknown(t,n){throw new Error(`No CBOR decorder regeistered for ${n} (0x${("0"+n.toString(16)).slice(-2)})`)}_overlay_noop(){}}class He extends K{static bind_decode_api(t){t.decode=n=>this.from_u8(n,t.types).decode_cbor(),t.iter_decode=n=>this.from_u8(n,t.types).iter_decode_cbor()}static get from_u8(){const t=new this;return(n,r)=>{n=S(n);const s={__proto__:t,idx:0,u8:n,_apply_overlay:t._overlay_noop};return r&&r!==t.types&&(s.types=r),s}}static bind_next_value(t,n){return n==null&&(n=this._error_unknown),function(){const s=this._apply_overlay(),i=this.u8[this.idx++];if(i===void 0)throw this.idx--,w;const o=(t[i]||n)(this,i);return s===void 0?o:s(o)}}decode_cbor(){try{return this.next_value()}catch(t){throw w!==t?t:new Error("End of content")}}*iter_decode_cbor(){try{for(;;)yield this.next_value()}catch(t){if(w!==t)throw t}}move(t){const{idx:n,byteLength:r}=this,s=n+t;if(s>=r)throw R;return this.idx=s,n}}const Y={bind_jmp(e,t){return t=t?t.slice():this.bind_basics_dispatch(new Map),e==null&&(e={}),e.simple&&this.bind_jmp_simple(e,t),e.tags&&this.bind_jmp_tag(e,t),t},bind_jmp_simple(e,t){if(e.simple){const n=this.bind_simple_dispatch(e.simple),r=this.cbor_tiny(n);for(let s=224;s<=243;s++)t[s]=r;t[248]=this.cbor_w1(n)}return t},bind_jmp_tag(e,t){if(e.tags){const n=this.bind_tag_dispatch(this.build_tags_lut(e.tags)),r=this.cbor_tiny(n);for(let s=192;s<=215;s++)t[192|s]=r;t[216]=this.cbor_w1(n),t[217]=this.cbor_w2(n),t[218]=this.cbor_w4(n),t[219]=this.cbor_w8(n)}return t},bind_basics_dispatch(e){this.bind_tag_dispatch(e);const t=this.cbor_tiny(this.as_pos_int),n=this.cbor_tiny(this.as_neg_int),r=this.cbor_tiny(this.as_bytes),s=this.cbor_tiny(this.as_utf8),i=this.cbor_tiny(this.as_list),_=this.cbor_tiny(this.as_map),o=this.cbor_tiny(this.as_tag),f=this.cbor_tiny(this.as_simple_repr),a=new Array(256);for(let c=0;c<=23;c++)a[0|c]=t,a[32|c]=n,a[64|c]=r,a[96|c]=s,a[128|c]=i,a[160|c]=_,a[192|c]=o,a[224|c]=f;const y=[this.cbor_w1,this.cbor_w2,this.cbor_w4,this.cbor_w8];for(let c=0;c<4;c++){const p=24+c,l=y[c];a[0|p]=l(this.as_pos_int),a[32|p]=l(this.as_neg_int),a[64|p]=l(this.as_bytes),a[96|p]=l(this.as_utf8),a[128|p]=l(this.as_list),a[160|p]=l(this.as_map),a[192|p]=l(this.as_tag)}return a[95]=c=>this.as_stream(c,c.types.bytes_stream()),a[127]=c=>this.as_stream(c,c.types.utf8_stream()),a[159]=c=>this.as_stream(c,c.types.list_stream()),a[191]=c=>this.as_pair_stream(c,c.types.map_stream()),a[244]=()=>!1,a[245]=()=>!0,a[246]=()=>null,a[247]=()=>{},a[248]=this.cbor_w1(this.as_simple_repr),a[249]=this.as_float16,a[250]=this.as_float32,a[251]=this.as_float64,a[255]=()=>g,a},as_pos_int:(e,t)=>t,as_neg_int:(e,t)=>-1-t,as_simple_repr:(e,t)=>`simple(${t})`,bind_simple_dispatch(e){if(typeof e.get!="function")throw new TypeError("Expected a simple_value Map");return(t,n)=>e.get(n)},build_tags_lut(e){let t=new Map,n=[e];for(;n.length!==0;){let r=n.pop();if(r===!0&&(r=ze),Array.isArray(r))n.push(...r);else if(r.from_cbor_decode)r.from_cbor_decode(t,b);else if(typeof r=="function")r(t,b);else for(let[s,i]of r.entries())t.set(s,i)}return t}},Je={__proto__:Y,cbor_tiny(e){return function(n,r){return e(n,r&31)}},cbor_w1(e){return function(n){const r=n.move(1);return e(n,n.u8[r])}},cbor_w2(e){return function(n){const r=n.u8,s=n.move(2);return e(n,r[s]<<8|r[s+1])}},cbor_w4(e){return function(n){const r=n.u8,s=n.move(4);return e(n,n.types.u32(r,s))}},cbor_w8(e){return function(n){const r=n.u8,s=n.move(8);return e(n,n.types.u64(r,s))}},as_bytes(e,t){const n=e.u8,r=e.move(t);return e.types.bytes(n.subarray(r,r+t))},as_utf8(e,t){const n=e.u8,r=e.move(t);return e.types.utf8(n.subarray(r,r+t))},as_list(e,t){const{res:n,accum:r,done:s}=e.types.list(t);for(let i=0;i<t;i++)r(n,i,e.next_value());return s!==void 0?s(n):n},as_map(e,t){const{res:n,accum:r,done:s}=e.types.map(t);for(let i=0;i<t;i++){const _=e.next_value(),o=e.next_value();r(n,_,o)}return s!==void 0?s(n):n},as_stream(e,{res:t,accum:n,done:r}){let s=0;for(;;){const i=e.next_value();if(g===i)return r!==void 0?r(t):t;n(t,s++,i)}},as_pair_stream(e,{res:t,accum:n,done:r}){for(;;){const s=e.next_value();if(g===s)return r!==void 0?r(t):t;n(t,s,e.next_value())}},as_float16(e){const t=e.u8,n=e.move(2);return e.types.float16(t.subarray(n,n+2))},as_float32(e){const t=e.u8,n=e.move(4);return e.types.float32(t,n)},as_float64(e){const t=e.u8,n=e.move(8);return e.types.float64(t,n)},bind_tag_dispatch(e){if(typeof e.get!="function")throw new TypeError("Expected a tags Map");return function(t,n){let r=e.get(n);if(!r)return L.from(n,t.next_value());let s=r(t,n),i=t.next_value();return s?s.custom_tag?s.custom_tag(t,n,i):s(i):i}}};class G extends q{static get decode(){return new this().decode}static get iter_decode(){return new this().iter_decode}_bind_cbor_jmp(t,n){return Je.bind_jmp(t,n)}_bind_u8ctx(t,n,r){return(this.U8DecodeCtx||He).subclass(t,n,r)}}G.compile({types:U});class H extends G{}H.compile({types:U,tags:[!0]});const{decode:J,iter_decode:it}=new H;async function*Qe(e){let t=yield,n=0,r=t,s;e.subarray&&(e=[e]);for await(let i of e){for(i=S(i),s&&(i=O([s,i]),s=void 0);r<=i.byteLength;)t=yield i.subarray(n,r),n=r,r+=t;s=n>=i.byteLength?void 0:i.subarray(n),n=0,r=t}}class Xe extends K{static bind_decode_api(t){t.decode_stream=n=>this.from_u8_stream(n,t.types).decode_cbor(),t.aiter_decode_stream=n=>this.from_u8_stream(n,t.types).aiter_decode_cbor()}static from_u8(t,n){return this.from_u8_stream(Se(t),n)}static get from_u8_stream(){const t=new this;return(n,r)=>{let s=Qe(n);s.next();const i={__proto__:t,_apply_overlay:t._overlay_noop,u8_aiter:s};return r&&r!==t.types&&(i.types=r),i}}static bind_next_value(t,n){return n==null&&(n=this._error_unknown),async function(){const s=this._apply_overlay(),[i]=await this.move_stream(1,w),o=await(t[i]||n)(this,i);return s===void 0?o:await s(o)}}async decode_cbor(){try{return await this.next_value()}catch(t){throw w!==t?t:new Error("End of content")}}async*aiter_decode_cbor(){try{for(;;)yield await this.next_value()}catch(t){if(w!==t)throw t}}async move_stream(t,n=R){let r=await this.u8_aiter.next(t);if(r.done)throw n;return r.value}}const Ze={__proto__:Y,cbor_tiny(e){return function(n,r){return e(n,r&31)}},cbor_w1(e){return async function(n){const r=await n.move_stream(1);return e(n,r[0])}},cbor_w2(e){return async function(n){const r=await n.move_stream(2);return e(n,r[0]<<8|r[1])}},cbor_w4(e){return async function(n){const r=await n.move_stream(4);return e(n,n.types.u32(r,0))}},cbor_w8(e){return async function(n){const r=await n.move_stream(8);return e(n,n.types.u64(r,0))}},async as_bytes(e,t){const n=await e.move_stream(t);return e.types.bytes(n.subarray(0,t))},async as_utf8(e,t){const n=await e.move_stream(t);return e.types.utf8(n.subarray(0,t))},async as_list(e,t){const{res:n,accum:r,done:s}=e.types.list(t);for(let i=0;i<t;i++)r(n,i,await e.next_value());return s!==void 0?s(n):n},async as_map(e,t){const{res:n,accum:r,done:s}=e.types.map(t);for(let i=0;i<t;i++){const _=await e.next_value(),o=await e.next_value();r(n,_,o)}return s!==void 0?s(n):n},async as_stream(e,{res:t,accum:n,done:r}){let s=0;for(;;){const i=await e.next_value();if(g===i)return r!==void 0?r(t):t;n(t,s++,i)}},async as_pair_stream(e,{res:t,accum:n,done:r}){for(;;){const s=await e.next_value();if(g===s)return r!==void 0?r(t):t;n(t,s,await e.next_value())}},async as_float16(e){return e.types.float16(await e.move_stream(2))},async as_float32(e){return e.types.float32(await e.move_stream(4))},async as_float64(e){return e.types.float64(await e.move_stream(8))},bind_tag_dispatch(e){if(typeof e.get!="function")throw new TypeError("Expected a tags Map");return async function(n,r){let s=e.get(r);if(!s)return L.from(r,await n.next_value());let i=await s(n,r),_=await n.next_value();return i?i.custom_tag?i.custom_tag(n,r,_):i(_):_}}};class Q extends q{static get decode_stream(){return new this().decode_stream}static get aiter_decode_stream(){return new this().aiter_decode_stream}_bind_cbor_jmp(t,n){return Ze.bind_jmp(t,n)}_bind_u8ctx(t,n,r){return(this.U8DecodeCtx||Xe).subclass(t,n,r)}}Q.compile({types:U});class X extends Q{}X.compile({types:U,tags:[!0]});new X;async function at(e){return await tt({path:e,tags:new Set,index:[],settings:{}})}function et(e){const{settings:t,symbols:n,index:r}=J(e);if(t.version!==4)throw new Error("Unsupported dataset format version");return n.forEach((s,i)=>{typeof s!="string"&&(n[i]=he(s,t.vectorBits,t.vectorSize))}),{settings:t,tags:new Set(Object.keys(r).flatMap(s=>s.split(",").map(i=>n[i]))),index:Object.entries(r).flatMap(([s,i])=>{const _=s.split(",").map(o=>n[o]);return Object.entries(i).flatMap(([o,f])=>{const a=o.split(",").map(c=>n[c]),y=Math.max(...ge(...a.filter(c=>typeof c!="string")));return fe(f,2).map(c=>({words:a,tags:_,diversity:y,path:c}))})})}}async function tt(e){const t={};e.etag&&(t["If-None-Match"]=e.etag),e.lastModified&&(t["If-Modified-Since"]=e.lastModified);const n=await fetch(`${e.path}/index.cbor`,{headers:t,mode:"cors"});return n.status===304?e:(n.status!==200&&console.warn("server response weird",n),M(x(x({},e),et(await n.arrayBuffer())),{etag:n.headers.get("ETag"),lastModified:n.headers.get("Last-Modified")}))}async function ot(e,t){const[n,r]=t.path,s=`${e.path}/definitions/${e.settings.buildID}/${n}.cbor`,i=await fetch(s,{mode:"cors",cache:"force-cache"}),_=J(await i.arrayBuffer());return M(x({library:e},_[r]),{media:_[r].media.map(o=>e.settings.mediaSets.map(f=>{const a=o[f.extension],y=`${e.path}/media/${a}`;return Object.assign(Object.create(f),{path:a,src:y})}))})}export{me as a,st as b,ue as c,we as d,tt as f,ot as g,it as i,ye as m,at as o,rt as s,he as u};
